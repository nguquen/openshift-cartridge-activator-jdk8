#!/bin/bash -e

source $OPENSHIFT_CARTRIDGE_SDK_BASH

function setup-jdk-8() {
  echo "Downloading and Configuring Java 8"
  if [ ! -d "${OPENSHIFT_DATA_DIR}/jdk" ]; then
    mkdir -p ${OPENSHIFT_DATA_DIR}/jdk
  fi

  if [ ! -d "${OPENSHIFT_DATA_DIR}/jdk/jdk1.8.0_60" ]; then
    pushd ${OPENSHIFT_DATA_DIR}/jdk
    wget --no-check-certificate --no-cookies --header "Cookie: oraclelicense=accept-securebackup-cookie" http://download.oracle.com/otn-pub/java/jdk/8u60-b27/jdk-8u60-linux-x64.tar.gz
    tar -zxf jdk-8u60-linux-x64.tar.gz
    rm jdk-8u60-linux-x64.tar.gz
    popd
  fi
  echo "Java 8 Downloaded"
}

function setup-activator() {
	echo "Downloading and Configuring Activator 1.3.6"
	if [ ! -d "${OPENSHIFT_DATA_DIR}/activator" ]; then
    	mkdir -p ${OPENSHIFT_DATA_DIR}/activator
  	fi

  	if [ ! -d "${OPENSHIFT_DATA_DIR}/activator/activator-1.3.6" ]; then
	    pushd ${OPENSHIFT_DATA_DIR}/activator
	    curl https://downloads.typesafe.com/typesafe-activator/1.3.6/typesafe-activator-1.3.6.zip > activator-1.3.6.zip
	    unzip activator-1.3.6.zip
	    rm activator-1.3.6.zip
	    popd
	fi
	echo "Activator 1.3.6 Downloaded"

}

setup-jdk-8
setup-activator

# set env variables
export JAVA_HOME="$OPENSHIFT_DATA_DIR/jdk/jdk1.8.0_60"
export ACTIVATOR_HOME="$OPENSHIFT_DATA_DIR/activator/activator-dist-1.3.6/"
echo $JAVA_HOME > $OPENSHIFT_PLAY2_DIR/env/JAVA_HOME
echo $ACTIVATOR_HOME > $OPENSHIFT_PLAY2_DIR/env/ACTIVATOR_HOME
echo "$JAVA_HOME/bin:$ACTIVATOR_HOME" > $OPENSHIFT_PLAY2_DIR/env/OPENSHIFT_PLAY2_PATH_ELEMENT
